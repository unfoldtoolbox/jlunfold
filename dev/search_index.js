var documenterSearchIndex = {"docs":
[{"location":"tutorials/lmm_mu/#Overlap-Correction-with-Linear-Mixed-Models","page":"(to be overhauled) Mass Univariate Mixed Model","title":"Overlap Correction with Linear Mixed Models","text":"","category":"section"},{"location":"tutorials/lmm_mu/","page":"(to be overhauled) Mass Univariate Mixed Model","title":"(to be overhauled) Mass Univariate Mixed Model","text":"using StatsModels, MixedModels, DataFrames,CategoricalArrays\nimport Plots\nusing Unfold\ninclude(\"../../../test/test_utilities.jl\"); # function to load the simulated data\nnothing;#hide","category":"page"},{"location":"tutorials/lmm_mu/","page":"(to be overhauled) Mass Univariate Mixed Model","title":"(to be overhauled) Mass Univariate Mixed Model","text":"This notebook is similar to the lm_tutorial, but fits mass-univariate mixed models ","category":"page"},{"location":"tutorials/lmm_mu/#Mass-Univariate-**Mixed**-Models","page":"(to be overhauled) Mass Univariate Mixed Model","title":"Mass Univariate Mixed Models","text":"","category":"section"},{"location":"tutorials/lmm_mu/","page":"(to be overhauled) Mass Univariate Mixed Model","title":"(to be overhauled) Mass Univariate Mixed Model","text":"Again we have 4 steps:","category":"page"},{"location":"tutorials/lmm_mu/","page":"(to be overhauled) Mass Univariate Mixed Model","title":"(to be overhauled) Mass Univariate Mixed Model","text":"epoch the data\nspecify a formula \nfit a linear model to each time point & channel\nvisualize the results.","category":"page"},{"location":"tutorials/lmm_mu/#.-Epoching","page":"(to be overhauled) Mass Univariate Mixed Model","title":"1. Epoching","text":"","category":"section"},{"location":"tutorials/lmm_mu/","page":"(to be overhauled) Mass Univariate Mixed Model","title":"(to be overhauled) Mass Univariate Mixed Model","text":"The data were simulated in MatLab using the unmixed toolbox (www.unfoldtoolbox.org) with the functionEEG_to_csv.m.","category":"page"},{"location":"tutorials/lmm_mu/","page":"(to be overhauled) Mass Univariate Mixed Model","title":"(to be overhauled) Mass Univariate Mixed Model","text":"\ndata, evts = loadtestdata(\"testCase3\",dataPath = \"../../../test/data/\")\ndata = data.+ 0.1*randn(size(data)) # we have to add minimal noise, else mixed models crashes.\n\ntransform!(evts,:subject=>categorical=>:subject);\nnothing #hide","category":"page"},{"location":"tutorials/lmm_mu/","page":"(to be overhauled) Mass Univariate Mixed Model","title":"(to be overhauled) Mass Univariate Mixed Model","text":"The events dataFrame has an additional column (besides being much taller): subject","category":"page"},{"location":"tutorials/lmm_mu/","page":"(to be overhauled) Mass Univariate Mixed Model","title":"(to be overhauled) Mass Univariate Mixed Model","text":"first(evts,6)","category":"page"},{"location":"tutorials/lmm_mu/","page":"(to be overhauled) Mass Univariate Mixed Model","title":"(to be overhauled) Mass Univariate Mixed Model","text":"note: Note\nNote how small the data is! Only 12k samples, that is only ~5minutes of recording in total for 25 subjects. More realistic samples quickly take hours to fit.\n```@example Main\nsize(data)\n```","category":"page"},{"location":"tutorials/lmm_mu/","page":"(to be overhauled) Mass Univariate Mixed Model","title":"(to be overhauled) Mass Univariate Mixed Model","text":"Now we are ready to epoch the data - same as for the mass univariate, but we have more trials (nsubject more)","category":"page"},{"location":"tutorials/lmm_mu/","page":"(to be overhauled) Mass Univariate Mixed Model","title":"(to be overhauled) Mass Univariate Mixed Model","text":"data_r = reshape(data,(1,:))\n# cut the data into epochs\ndata_epochs,times = Unfold.epoch(data=data_r,tbl=evts,Ï„=(-0.4,0.8),sfreq=50);\n# missing or partially missing epochs are currenlty _only_ supported for non-mixed models!\nevts,data_epochs = Unfold.dropMissingEpochs(evts,data_epochs); nothing #hide","category":"page"},{"location":"tutorials/lmm_mu/#.-Specify-the-formula","page":"(to be overhauled) Mass Univariate Mixed Model","title":"2. Specify the formula","text":"","category":"section"},{"location":"tutorials/lmm_mu/","page":"(to be overhauled) Mass Univariate Mixed Model","title":"(to be overhauled) Mass Univariate Mixed Model","text":"We define the formula. Importantly we need to specify a random effect. We are using zerocorr to speed up the calculation and show off that we can use it.","category":"page"},{"location":"tutorials/lmm_mu/","page":"(to be overhauled) Mass Univariate Mixed Model","title":"(to be overhauled) Mass Univariate Mixed Model","text":"f  = @formula 0~1+condA*condB+zerocorr(1+condA*condB|subject);","category":"page"},{"location":"tutorials/lmm_mu/#.-Fit-the-model","page":"(to be overhauled) Mass Univariate Mixed Model","title":"3. Fit the model","text":"","category":"section"},{"location":"tutorials/lmm_mu/","page":"(to be overhauled) Mass Univariate Mixed Model","title":"(to be overhauled) Mass Univariate Mixed Model","text":"We can now run the LinearMixedModel on each time point","category":"page"},{"location":"tutorials/lmm_mu/","page":"(to be overhauled) Mass Univariate Mixed Model","title":"(to be overhauled) Mass Univariate Mixed Model","text":"m,results = fit(UnfoldLinearMixedModel,f,evts,data_epochs,times) ","category":"page"},{"location":"tutorials/lmm_mu/#.-Visualize-results","page":"(to be overhauled) Mass Univariate Mixed Model","title":"4. Visualize results","text":"","category":"section"},{"location":"tutorials/lmm_mu/","page":"(to be overhauled) Mass Univariate Mixed Model","title":"(to be overhauled) Mass Univariate Mixed Model","text":"!!! note We are working on UnfoldMakie.jl - a library to make these plots automatic and beautiful. This tutorial will be updated","category":"page"},{"location":"tutorials/lmm_mu/","page":"(to be overhauled) Mass Univariate Mixed Model","title":"(to be overhauled) Mass Univariate Mixed Model","text":"Let's start with the fixed Effects","category":"page"},{"location":"tutorials/lmm_mu/","page":"(to be overhauled) Mass Univariate Mixed Model","title":"(to be overhauled) Mass Univariate Mixed Model","text":"res_fixef = results[results.group.==:fixed,:]\nPlots.plot(res_fixef.colname_basis,res_fixef.estimate,\n        group=res_fixef.term,\n        layout=1,legend=:outerbottom)","category":"page"},{"location":"tutorials/lmm_mu/","page":"(to be overhauled) Mass Univariate Mixed Model","title":"(to be overhauled) Mass Univariate Mixed Model","text":"We see the condition effects and some residual overlap activity in the fixed effects","category":"page"},{"location":"tutorials/lmm_mu/","page":"(to be overhauled) Mass Univariate Mixed Model","title":"(to be overhauled) Mass Univariate Mixed Model","text":"And now the random effect results","category":"page"},{"location":"tutorials/lmm_mu/","page":"(to be overhauled) Mass Univariate Mixed Model","title":"(to be overhauled) Mass Univariate Mixed Model","text":"res_ranef = results[results.group.==:subject,:]\nPlots.plot(res_ranef.colname_basis,res_ranef.estimate,\n        group=res_ranef.term,\n        layout=1,legend=:outerbottom)","category":"page"},{"location":"tutorials/lmm_mu/","page":"(to be overhauled) Mass Univariate Mixed Model","title":"(to be overhauled) Mass Univariate Mixed Model","text":"The random effects are very high in areas where we simulated overlap. (i.e. <-0.1 and >0.2)","category":"page"},{"location":"tutorials/lm_overlap/#Mass-Univariate-Linear-Models-(no-overlap-correction)","page":"Overlap correction","title":"Mass Univariate Linear Models (no overlap correction)","text":"","category":"section"},{"location":"tutorials/lm_overlap/","page":"Overlap correction","title":"Overlap correction","text":"!!! note We assume you went through the mass-univariate linear modelling tutorial before!","category":"page"},{"location":"tutorials/lm_overlap/","page":"Overlap correction","title":"Overlap correction","text":"using Plots; gr()\nPlots.reset_defaults();","category":"page"},{"location":"tutorials/lm_overlap/#Setting-up-and-loading-the-data","page":"Overlap correction","title":"Setting up & loading the data","text":"","category":"section"},{"location":"tutorials/lm_overlap/","page":"Overlap correction","title":"Overlap correction","text":"using StatsModels, MixedModels, DataFrames\nimport DSP.conv\nimport Plots\nusing Unfold\ninclude(\"../../../test/test_utilities.jl\"); # to load the simulated data\n\nnothing # hide","category":"page"},{"location":"tutorials/lm_overlap/","page":"Overlap correction","title":"Overlap correction","text":"In this notebook we will fit regression models to (simulated) EEG data. We will see that we need some type of overlap correction, as the events are close in time to each other, so that the respective brain responses overlap. If you want more detailed introduction to this topic check out our paper.","category":"page"},{"location":"tutorials/lm_overlap/","page":"Overlap correction","title":"Overlap correction","text":"data, evts = loadtestdata(\"testCase2\",dataPath=\"../../../test/data/\");\nnothing # hide","category":"page"},{"location":"tutorials/lm_overlap/#Overlap-Correction","page":"Overlap correction","title":"Overlap Correction","text":"","category":"section"},{"location":"tutorials/lm_overlap/","page":"Overlap correction","title":"Overlap correction","text":"For an overlap correction analysis we will have slightly different steps.","category":"page"},{"location":"tutorials/lm_overlap/","page":"Overlap correction","title":"Overlap correction","text":"specify a temporal basisfunction\nspecify a formula\nfit a linear model for each channel (one for all timepoints!)\nvisualize the results.","category":"page"},{"location":"tutorials/lm_overlap/#Timeexpanded-/-Deconvolved-ModelFit","page":"Overlap correction","title":"Timeexpanded / Deconvolved ModelFit","text":"","category":"section"},{"location":"tutorials/lm_overlap/#.-specify-a-temporal-basisfunction","page":"Overlap correction","title":"1. specify a temporal basisfunction","text":"","category":"section"},{"location":"tutorials/lm_overlap/","page":"Overlap correction","title":"Overlap correction","text":"By default, we would want to use a FIR basisfunction. See basisfunctions.md for more details.","category":"page"},{"location":"tutorials/lm_overlap/","page":"Overlap correction","title":"Overlap correction","text":"basisfunction = firbasis(Ï„=(-0.4,.8),sfreq=50,name=\"stimulus\")\nnothing #hide","category":"page"},{"location":"tutorials/lm_overlap/#.-specify-a-formula","page":"Overlap correction","title":"2. specify a formula","text":"","category":"section"},{"location":"tutorials/lm_overlap/","page":"Overlap correction","title":"Overlap correction","text":"We specify the same formula as before","category":"page"},{"location":"tutorials/lm_overlap/","page":"Overlap correction","title":"Overlap correction","text":"f  = @formula 0~1+conditionA+conditionB\nnothing #hide","category":"page"},{"location":"tutorials/lm_overlap/#.-fit-the-linear-model","page":"Overlap correction","title":"3. fit the linear model","text":"","category":"section"},{"location":"tutorials/lm_overlap/","page":"Overlap correction","title":"Overlap correction","text":"The formula and basisfunction is not enough on their own. We also need to specify which event and which formula matches - this is important in cases where there are multiple events with different formulas","category":"page"},{"location":"tutorials/lm_overlap/","page":"Overlap correction","title":"Overlap correction","text":"bfDict = Dict(Any=>(f,basisfunction))","category":"page"},{"location":"tutorials/lm_overlap/","page":"Overlap correction","title":"Overlap correction","text":"!!! note You can also use (Any=>(f,basisfunction), the Any means to use all rows in evts. In case you have multiple events, you'd want to specify multiple basisfunctions e.g. ","category":"page"},{"location":"tutorials/lm_overlap/","page":"Overlap correction","title":"Overlap correction","text":"        bfDict = Dict(\"stimulus\"=>(f1,basisfunction1),\n              \"response\"=>(f2,basisfunction2))\n        m,results = fit(UnfoldLinearModel,bfDict,evts,data);\n        ```\n\n        You likely have to specify a further argument to `fit`: `eventcolumn=\"type\"` with `type` being the column in `evts` that codes for the event (stimulus / response in this case)\n\n\n\nNow we are ready to fit a `UnfoldLinearModel`. Not that instead of `times` as in the mass-univariate case, we have to provide the `BasisFunction` dictionary now.\n","category":"page"},{"location":"tutorials/lm_overlap/","page":"Overlap correction","title":"Overlap correction","text":"@example Main m,results = fit(UnfoldLinearModel,bfDict,evts,data);  nothing #hide","category":"page"},{"location":"tutorials/lm_overlap/","page":"Overlap correction","title":"Overlap correction","text":"\n#### 4. Visualize the model\nSimilarly to the previous tutorial, we can visualize the model","category":"page"},{"location":"tutorials/lm_overlap/","page":"Overlap correction","title":"Overlap correction","text":"@example Main Plots.plot(results.colname_basis,results.estimate,         group=results.term,         layout=1,legend=:outerbottom) ``` Cool! All overlapping activity has been removed and we recovered the simulated underlying signal.","category":"page"},{"location":"tutorials/lm_mu/#Mass-Univariate-Linear-Models-(no-overlap-correction)","page":"Mass Univariate","title":"Mass Univariate Linear Models (no overlap correction)","text":"","category":"section"},{"location":"tutorials/lm_mu/","page":"Mass Univariate","title":"Mass Univariate","text":"using Plots; gr()\nPlots.reset_defaults();","category":"page"},{"location":"tutorials/lm_mu/#Installation","page":"Mass Univariate","title":"Installation","text":"","category":"section"},{"location":"tutorials/lm_mu/","page":"Mass Univariate","title":"Mass Univariate","text":"See the installation tutorial","category":"page"},{"location":"tutorials/lm_mu/#Setting-up-and-loading-the-data","page":"Mass Univariate","title":"Setting up & loading the data","text":"","category":"section"},{"location":"tutorials/lm_mu/","page":"Mass Univariate","title":"Mass Univariate","text":"using StatsModels, MixedModels, DataFrames\nimport DSP.conv\nimport Plots\nusing Unfold\ninclude(\"../../../test/test_utilities.jl\"); # to load the simulated data\n\nnothing # hide","category":"page"},{"location":"tutorials/lm_mu/","page":"Mass Univariate","title":"Mass Univariate","text":"In this notebook we will fit regression models to (simulated) EEG data. We will see that we need some type o7overlap correction, as the events are close in time to each other, so that the respective brain responses overlap. If you want more detailed introduction to this topic check out our paper.","category":"page"},{"location":"tutorials/lm_mu/","page":"Mass Univariate","title":"Mass Univariate","text":"data, evts = loadtestdata(\"testCase2\",dataPath=\"../../../test/data/\");\nnothing # hide","category":"page"},{"location":"tutorials/lm_mu/","page":"Mass Univariate","title":"Mass Univariate","text":"The data has little noise and the underlying signal is a pos-neg spike pattern","category":"page"},{"location":"tutorials/lm_mu/","page":"Mass Univariate","title":"Mass Univariate","text":"times = range(1/50,length=200,step=1/50)\nPlots.plot(times,data[1:200])\nPlots.vline!(evts[evts.latency.<=200,:latency]./50) # show events, latency in samples!","category":"page"},{"location":"tutorials/lm_mu/","page":"Mass Univariate","title":"Mass Univariate","text":"To inspect the event dataframe we use","category":"page"},{"location":"tutorials/lm_mu/","page":"Mass Univariate","title":"Mass Univariate","text":"show(first(evts,6,),allcols=true)","category":"page"},{"location":"tutorials/lm_mu/","page":"Mass Univariate","title":"Mass Univariate","text":"Every row is an event. Note that :latency is commonly the timestamp in samples, whereas :onset would typically refer to seconds.","category":"page"},{"location":"tutorials/lm_mu/#Traditional-Mass-Univariate-Analysis","page":"Mass Univariate","title":"Traditional Mass Univariate Analysis","text":"","category":"section"},{"location":"tutorials/lm_mu/","page":"Mass Univariate","title":"Mass Univariate","text":"For a mass univariate analysis, will ","category":"page"},{"location":"tutorials/lm_mu/","page":"Mass Univariate","title":"Mass Univariate","text":"epoch the data\nspecify a formula \nfit a linear model to each time point & channel\nvisualize the results.","category":"page"},{"location":"tutorials/lm_mu/#.-Epoch-the-data","page":"Mass Univariate","title":"1. Epoch the data","text":"","category":"section"},{"location":"tutorials/lm_mu/","page":"Mass Univariate","title":"Mass Univariate","text":"We have to cut the data into small regular trials.","category":"page"},{"location":"tutorials/lm_mu/","page":"Mass Univariate","title":"Mass Univariate","text":"# we have multi channel support\ndata_r = reshape(data,(1,:))\n# cut the data into epochs\ndata_epochs,times = Unfold.epoch(data=data_r,tbl=evts,Ï„=(-0.4,0.8),sfreq=50);\nsize(data_epochs)","category":"page"},{"location":"tutorials/lm_mu/","page":"Mass Univariate","title":"Mass Univariate","text":"Ï„ specifies the epoch size. To convert Ï„ to samples, we need to specify the sampling rate.","category":"page"},{"location":"tutorials/lm_mu/","page":"Mass Univariate","title":"Mass Univariate","text":"typeof(data_epochs)","category":"page"},{"location":"tutorials/lm_mu/","page":"Mass Univariate","title":"Mass Univariate","text":"!!! note In julia, missing is supported throughout the ecosystem. Thus, we can have partial trials and they will be incorporated / ignored at the respective functions.","category":"page"},{"location":"tutorials/lm_mu/#.-Specify-a-formula","page":"Mass Univariate","title":"2. Specify a formula","text":"","category":"section"},{"location":"tutorials/lm_mu/","page":"Mass Univariate","title":"Mass Univariate","text":"We define a formula that we want to apply to each point in time","category":"page"},{"location":"tutorials/lm_mu/","page":"Mass Univariate","title":"Mass Univariate","text":"f  = @formula 0~1+conditionA+conditionB # 0 as a dummy, we will combine wit data later\nnothing # hide","category":"page"},{"location":"tutorials/lm_mu/#.-fit-a-linear-model-to-each-time-point-and-channel","page":"Mass Univariate","title":"3. fit a linear model to each time-point & channel","text":"","category":"section"},{"location":"tutorials/lm_mu/","page":"Mass Univariate","title":"Mass Univariate","text":"We fit the UnfoldLinearModel.","category":"page"},{"location":"tutorials/lm_mu/","page":"Mass Univariate","title":"Mass Univariate","text":"m,results = Unfold.fit(UnfoldLinearModel,f,evts,data_epochs,times); \nnothing #hide","category":"page"},{"location":"tutorials/lm_mu/","page":"Mass Univariate","title":"Mass Univariate","text":"We can inspect the object","category":"page"},{"location":"tutorials/lm_mu/","page":"Mass Univariate","title":"Mass Univariate","text":"m","category":"page"},{"location":"tutorials/lm_mu/","page":"Mass Univariate","title":"Mass Univariate","text":"And see that it  contains the model, the original formula, the original events.","category":"page"},{"location":"tutorials/lm_mu/","page":"Mass Univariate","title":"Mass Univariate","text":"Further, we got a tidy-dataframe with the results","category":"page"},{"location":"tutorials/lm_mu/","page":"Mass Univariate","title":"Mass Univariate","text":"first(results,6)","category":"page"},{"location":"tutorials/lm_mu/","page":"Mass Univariate","title":"Mass Univariate","text":"!!! note (:colname_basis is used instead of :time [this might change]. The reason is that not all basisfunctions have a time dimension)","category":"page"},{"location":"tutorials/lm_mu/#.-Visualize-the-results","page":"Mass Univariate","title":"4. Visualize the results","text":"","category":"section"},{"location":"tutorials/lm_mu/","page":"Mass Univariate","title":"Mass Univariate","text":"Tidy-Dataframes make them easy to visualize.","category":"page"},{"location":"tutorials/lm_mu/","page":"Mass Univariate","title":"Mass Univariate","text":"Plots.plot(results.colname_basis,results.estimate,\n        group=results.term,\n        layout=1,legend=:outerbottom)","category":"page"},{"location":"tutorials/lm_mu/","page":"Mass Univariate","title":"Mass Univariate","text":"As you can see here, a lot is going on, even in the baseline-period. Head over to the next tutorial to find out how to remedy this.","category":"page"},{"location":"references/datastructures/#What-is-happening-under-the-hood?","page":"-","title":"What is happening under the hood?","text":"","category":"section"},{"location":"references/datastructures/","page":"-","title":"-","text":"\nXdc = designmatrix(UnfoldLinearMixedModel,f,evts,basisfunction)","category":"page"},{"location":"references/datastructures/","page":"-","title":"-","text":"Formula-Terms are wrapped with a TimeExpandedTerm, which upon calling modelcols will timeexpand the designmatrix. There is one TimeExpandedTerm for the FixedEffects and one for each RandomEffectsTerm.","category":"page"},{"location":"references/datastructures/","page":"-","title":"-","text":"typeof(Xdc.formulas.rhs)","category":"page"},{"location":"references/datastructures/","page":"-","title":"-","text":"Visualizing the designmatrices. Fixed Effects:","category":"page"},{"location":"references/datastructures/","page":"-","title":"-","text":"\nPlots.heatmap(Matrix(Xdc.Xs[1][1:300,:]))","category":"page"},{"location":"references/datastructures/","page":"-","title":"-","text":"Random Effects","category":"page"},{"location":"references/datastructures/","page":"-","title":"-","text":"\nPlots.heatmap(Matrix(Xdc.Xs[2][1:2000,1:500]))","category":"page"},{"location":"references/datastructures/","page":"-","title":"-","text":"And finally, generate the linear mixed model manually & fit it.","category":"page"},{"location":"references/datastructures/","page":"-","title":"-","text":"mf = unfoldfit(Unfold.UnfoldLinearMixedModel,Xs,data)\nresults = condense_long(mf)\nfirst(results,6)","category":"page"},{"location":"tutorials/lmm_overlap/#Overlap-Correction-with-Linear-Mixed-Models","page":"(to be overhauled) Mixed Model with Overlap","title":"Overlap Correction with Linear Mixed Models","text":"","category":"section"},{"location":"tutorials/lmm_overlap/","page":"(to be overhauled) Mixed Model with Overlap","title":"(to be overhauled) Mixed Model with Overlap","text":"using StatsModels, MixedModels, DataFrames,CategoricalArrays\nimport Plots\nusing Unfold\ninclude(\"../../../test/test_utilities.jl\"); # function to load the simulated data\nnothing;#hide","category":"page"},{"location":"tutorials/lmm_overlap/","page":"(to be overhauled) Mixed Model with Overlap","title":"(to be overhauled) Mixed Model with Overlap","text":"This notebook is similar to the tutorials/lm_overlap.md, but fits mixed models with overlapcorrection","category":"page"},{"location":"tutorials/lmm_overlap/","page":"(to be overhauled) Mixed Model with Overlap","title":"(to be overhauled) Mixed Model with Overlap","text":"!!! warning Limitation: This is not production ready at all. Still lot's of things to find out and tinker with. Don't use this if you did not look under the hood of the toolbox!","category":"page"},{"location":"tutorials/lmm_overlap/#Load-the-data","page":"(to be overhauled) Mixed Model with Overlap","title":"Load the data","text":"","category":"section"},{"location":"tutorials/lmm_overlap/","page":"(to be overhauled) Mixed Model with Overlap","title":"(to be overhauled) Mixed Model with Overlap","text":"\ndat, evts = loadtestdata(\"testCase3\",dataPath = \"../../../test/data/\")\ndat = dat.+ 0.1*randn(size(dat)) # we have to add minimal noise, else mixed models crashes.\n\nevts.subject  = categorical(Array(evts.subject))\n\n\nnothing #hide","category":"page"},{"location":"tutorials/lmm_overlap/#Mass-Univariate-**Mixed**-Models","page":"(to be overhauled) Mixed Model with Overlap","title":"Mass Univariate Mixed Models","text":"","category":"section"},{"location":"tutorials/lmm_overlap/","page":"(to be overhauled) Mixed Model with Overlap","title":"(to be overhauled) Mixed Model with Overlap","text":"Again we have 4 steps:","category":"page"},{"location":"tutorials/lmm_overlap/","page":"(to be overhauled) Mixed Model with Overlap","title":"(to be overhauled) Mixed Model with Overlap","text":"specify a temporal basisfunction\nspecify a formula\nfit a linear model for each channel (one for all timepoints!)\nvisualize the results.","category":"page"},{"location":"tutorials/lmm_overlap/#.-specify-a-temporal-basisfunction","page":"(to be overhauled) Mixed Model with Overlap","title":"1. specify a temporal basisfunction","text":"","category":"section"},{"location":"tutorials/lmm_overlap/","page":"(to be overhauled) Mixed Model with Overlap","title":"(to be overhauled) Mixed Model with Overlap","text":"By default, we would want to use a FIR basisfunction. See basisfunctions.md for more details.","category":"page"},{"location":"tutorials/lmm_overlap/","page":"(to be overhauled) Mixed Model with Overlap","title":"(to be overhauled) Mixed Model with Overlap","text":"basisfunction = firbasis(Ï„=(-0.4,.8),sfreq=50,name=\"stimulus\")\nnothing #hide","category":"page"},{"location":"tutorials/lmm_overlap/#.-Specify-the-formula","page":"(to be overhauled) Mixed Model with Overlap","title":"2. Specify the formula","text":"","category":"section"},{"location":"tutorials/lmm_overlap/","page":"(to be overhauled) Mixed Model with Overlap","title":"(to be overhauled) Mixed Model with Overlap","text":"We define the formula. Importantly we need to specify a random effect. ","category":"page"},{"location":"tutorials/lmm_overlap/","page":"(to be overhauled) Mixed Model with Overlap","title":"(to be overhauled) Mixed Model with Overlap","text":"!!! note We are using zerocorr because we need it here, else the model will try to model all correlations between all timepoints and all factors!","category":"page"},{"location":"tutorials/lmm_overlap/","page":"(to be overhauled) Mixed Model with Overlap","title":"(to be overhauled) Mixed Model with Overlap","text":"f  = @formula 0~1+condA*condB+zerocorr(1+condA*condB|subject);","category":"page"},{"location":"tutorials/lmm_overlap/#.-Fit-the-model","page":"(to be overhauled) Mixed Model with Overlap","title":"3. Fit the model","text":"","category":"section"},{"location":"tutorials/lmm_overlap/","page":"(to be overhauled) Mixed Model with Overlap","title":"(to be overhauled) Mixed Model with Overlap","text":"bfDict = Dict(Any=>(f,basisfunction))\n# for some reason this results in a big error. Skipping this tutorial right now\n#m,results = fit(UnfoldLinearMixedModel,bfDict,evts,data) ","category":"page"},{"location":"tutorials/lmm_overlap/#.-Visualize-results","page":"(to be overhauled) Mixed Model with Overlap","title":"4. Visualize results","text":"","category":"section"},{"location":"tutorials/lmm_overlap/","page":"(to be overhauled) Mixed Model with Overlap","title":"(to be overhauled) Mixed Model with Overlap","text":"!!! note We are working on UnfoldMakie.jl - a library to make these plots automatic and beautiful. This tutorial will be updated","category":"page"},{"location":"tutorials/lmm_overlap/","page":"(to be overhauled) Mixed Model with Overlap","title":"(to be overhauled) Mixed Model with Overlap","text":"Let's start with the fixed Effects","category":"page"},{"location":"tutorials/lmm_overlap/","page":"(to be overhauled) Mixed Model with Overlap","title":"(to be overhauled) Mixed Model with Overlap","text":"res_fixef = results[results.group.==:fixed,:]\nPlots.plot(res_fixef.colname_basis,res_fixef.estimate,\n        group=res_fixef.term,\n        layout=1,legend=:outerbottom)","category":"page"},{"location":"tutorials/lmm_overlap/","page":"(to be overhauled) Mixed Model with Overlap","title":"(to be overhauled) Mixed Model with Overlap","text":"And now the random effect results","category":"page"},{"location":"tutorials/lmm_overlap/","page":"(to be overhauled) Mixed Model with Overlap","title":"(to be overhauled) Mixed Model with Overlap","text":"res_ranef = results[results.group.==:subject,:]\nPlots.plot(res_ranef.colname_basis,res_ranef.estimate,\n        group=res_ranef.term,\n        layout=1,legend=:outerbottom)","category":"page"},{"location":"#Unfold-Documentation","page":"Unfold Documentation","title":"Unfold Documentation","text":"","category":"section"},{"location":"","page":"Unfold Documentation","title":"Unfold Documentation","text":"Documentation is currently written.","category":"page"},{"location":"","page":"Unfold Documentation","title":"Unfold Documentation","text":"Best to start with installation, then go for the mass-univariate approach lm_mu.md, which should be familiar to you if you did ERPs before. Then the overlap-correction lm_overlap.md, LMM (to-be-done) and non-linear (to-be-done) would be good stations.","category":"page"},{"location":"","page":"Unfold Documentation","title":"Unfold Documentation","text":"In case you want to understand the tools better, check out our explanations.","category":"page"},{"location":"","page":"Unfold Documentation","title":"Unfold Documentation","text":"Once you are familiar with the tools, check out further how-to guides for specific applications.","category":"page"},{"location":"","page":"Unfold Documentation","title":"Unfold Documentation","text":"In case you want to understand the toolbox better, we plan to offer technical references. This includes Benchmarks & Explorations.","category":"page"},{"location":"#Summary","page":"Unfold Documentation","title":"Summary","text":"","category":"section"},{"location":"#Summary-2","page":"Unfold Documentation","title":"Summary","text":"","category":"section"},{"location":"","page":"Unfold Documentation","title":"Unfold Documentation","text":"There are four different model types currently \"fitable\"","category":"page"},{"location":"","page":"Unfold Documentation","title":"Unfold Documentation","text":"Timeexpansion No, Mixed No  : fit(UnfoldLinearModel,f,evts,data_epoch,times)\nTimeexpansion Yes, Mixed No : fit(UnfoldLinearModel,f,evts,data,basisfunction)\nTimeexpansion No, Mixed Yes : fit(UnfoldLinearMixedModel,f,evts,data_epoch,times)\nTimeexpansion Yes, Mixed Yes: fit(UnfoldLinearMixedModel,f,evts,data,basisfunction)","category":"page"},{"location":"#TOC","page":"Unfold Documentation","title":"TOC","text":"","category":"section"},{"location":"","page":"Unfold Documentation","title":"Unfold Documentation","text":"","category":"page"},{"location":"explanations/basisfunctions/#Basis-Functions","page":"Temporal Basisfunctions","title":"Basis Functions","text":"","category":"section"},{"location":"explanations/basisfunctions/","page":"Temporal Basisfunctions","title":"Temporal Basisfunctions","text":"using Plots; gr()\nPlots.reset_defaults();","category":"page"},{"location":"explanations/basisfunctions/","page":"Temporal Basisfunctions","title":"Temporal Basisfunctions","text":"This document provides you an explanation of basisfunctions. We start with fMRI because they are very popular.","category":"page"},{"location":"explanations/basisfunctions/#HRF-/-BOLD","page":"Temporal Basisfunctions","title":"HRF / BOLD","text":"","category":"section"},{"location":"explanations/basisfunctions/","page":"Temporal Basisfunctions","title":"Temporal Basisfunctions","text":"We want to define a basisfunction. There are currently only few basisfunction implemented in Unfold.jl, but your imagination knows no borders!","category":"page"},{"location":"explanations/basisfunctions/","page":"Temporal Basisfunctions","title":"Temporal Basisfunctions","text":"We first have a look at the BOLD-HRF basisfunction:","category":"page"},{"location":"explanations/basisfunctions/","page":"Temporal Basisfunctions","title":"Temporal Basisfunctions","text":"using Unfold,DSP\n\nTR = 1.5\nbold = hrfbasis(TR) # using default SPM parameters\neventonset = 1.3\nplot(bold.kernel(eventonset))","category":"page"},{"location":"explanations/basisfunctions/","page":"Temporal Basisfunctions","title":"Temporal Basisfunctions","text":"This is the shape that is assumed to reflect activity to an event. Generally, we would like to know how much to scale this response-shape per condition, e.g. in condA we might scale it by 0.7, in condB by 1.2.","category":"page"},{"location":"explanations/basisfunctions/","page":"Temporal Basisfunctions","title":"Temporal Basisfunctions","text":"But let's start at the beginning and first simulate an fMRI signal. Then you will also appreciate why we need to deconvolve it later.","category":"page"},{"location":"explanations/basisfunctions/#Convolving-a-responseshape-to-get-a-\"recorded\"-fMRI-signal","page":"Temporal Basisfunctions","title":"Convolving a responseshape to get a \"recorded\" fMRI signal","text":"","category":"section"},{"location":"explanations/basisfunctions/","page":"Temporal Basisfunctions","title":"Temporal Basisfunctions","text":"We start with convolving this HRF function with a impulse-vector, with impulse at the event onsets","category":"page"},{"location":"explanations/basisfunctions/","page":"Temporal Basisfunctions","title":"Temporal Basisfunctions","text":"y = zeros(100) # signal length = 100\ny[[10,30,45]] .=0.7 # 3 events at given for condition A\ny[[37]] .=1.2 # 1 events at given for condition B\ny_conv = conv(y,bold.kernel(0)) # convolve!\nplot(y_conv) ","category":"page"},{"location":"explanations/basisfunctions/","page":"Temporal Basisfunctions","title":"Temporal Basisfunctions","text":"Next we would add some noise","category":"page"},{"location":"explanations/basisfunctions/","page":"Temporal Basisfunctions","title":"Temporal Basisfunctions","text":"using Random\ny_conv += randn(size(y_conv))\nplot(y_conv)","category":"page"},{"location":"explanations/basisfunctions/","page":"Temporal Basisfunctions","title":"Temporal Basisfunctions","text":"ðŸŽ‰ - we did it, we simulated fMRI data.","category":"page"},{"location":"explanations/basisfunctions/","page":"Temporal Basisfunctions","title":"Temporal Basisfunctions","text":"!!! note Eents could fall inbetween TR (the sampling rate). Some packages subsample the time signal, but in Unfold we can directly call the bold.kernel function at a given event-time, which allows for non-TR-multiples to be used.","category":"page"},{"location":"explanations/basisfunctions/","page":"Temporal Basisfunctions","title":"Temporal Basisfunctions","text":"Now you can appreciate, that the conditions overlap in time with eachother. To get back to the original amplitude values, we need to specify a basis function, and use Unfold to deconvolve the signals.","category":"page"},{"location":"explanations/basisfunctions/#FIR-Basis-Function","page":"Temporal Basisfunctions","title":"FIR Basis Function","text":"","category":"section"},{"location":"explanations/basisfunctions/","page":"Temporal Basisfunctions","title":"Temporal Basisfunctions","text":"Okay, let's have a look at a different basis function: The FIR basisfunction.","category":"page"},{"location":"explanations/basisfunctions/","page":"Temporal Basisfunctions","title":"Temporal Basisfunctions","text":"using Unfold #hide\n\nbasisfunction = firbasis(Ï„=(-0.4,.8),sfreq=50,name=\"myFIRbasis\")\nplot(basisfunction.kernel(0))","category":"page"},{"location":"explanations/basisfunctions/","page":"Temporal Basisfunctions","title":"Temporal Basisfunctions","text":"Not very clear, better show it in 2D","category":"page"},{"location":"explanations/basisfunctions/","page":"Temporal Basisfunctions","title":"Temporal Basisfunctions","text":"basisfunction.kernel(0)[1:10,1:10]","category":"page"},{"location":"explanations/basisfunctions/","page":"Temporal Basisfunctions","title":"Temporal Basisfunctions","text":"(all . are 0's)","category":"page"},{"location":"explanations/basisfunctions/","page":"Temporal Basisfunctions","title":"Temporal Basisfunctions","text":"The FIR basisset consists of multiple basisfunctions. That is, each event will now be timeexpanded to multiple predictors, each with a certain time-delay to the event onset. This allows to model any arbitrary linear overlap shape, and doesn't force us to make assumptions on the convolution kernel (like we had to do in the BOLD case)","category":"page"},{"location":"tutorials/installation/#Installation","page":"Running these tutorials","title":"Installation","text":"","category":"section"},{"location":"tutorials/installation/#getting-into-the-right-environment","page":"Running these tutorials","title":"getting into the right environment","text":"","category":"section"},{"location":"tutorials/installation/","page":"Running these tutorials","title":"Running these tutorials","text":"First we have to install some packages. in julia you would do this either by putting a ] in the REPL (\"julia-commandline\").","category":"page"},{"location":"tutorials/installation/","page":"Running these tutorials","title":"Running these tutorials","text":"This should result in ","category":"page"},{"location":"tutorials/installation/","page":"Running these tutorials","title":"Running these tutorials","text":"(currentFolder) pkg> ","category":"page"},{"location":"tutorials/installation/","page":"Running these tutorials","title":"Running these tutorials","text":"(with currentFolder being the project you currently work in) - but if you see ","category":"page"},{"location":"tutorials/installation/","page":"Running these tutorials","title":"Running these tutorials","text":"(@v1.6) pkg>","category":"page"},{"location":"tutorials/installation/","page":"Running these tutorials","title":"Running these tutorials","text":"instead, you still have to activate your environment (using cd(\"/path/to/your/project\") and ]activate . or ]activate /path/to/your/project/)","category":"page"},{"location":"tutorials/installation/","page":"Running these tutorials","title":"Running these tutorials","text":"!!! note You should have done this already to install Unfold in the first place. have a look at the Readme.md - there we use the Pkg.add(\"\") syntax, which is equivalent to the ] package manager.","category":"page"},{"location":"tutorials/installation/#installing-packages-for-the-documentation","page":"Running these tutorials","title":"installing packages for the documentation","text":"","category":"section"},{"location":"tutorials/installation/","page":"Running these tutorials","title":"Running these tutorials","text":"Now we are ready to add packages:","category":"page"},{"location":"tutorials/installation/","page":"Running these tutorials","title":"Running these tutorials","text":"add StatsModels,MixedModels,DataFrames,DSP.conv,Plots","category":"page"},{"location":"tutorials/installation/","page":"Running these tutorials","title":"Running these tutorials","text":"Next we have to make sure to be in the Unfold/docs folder, else the tutorial will not be able to find the data. Thus cd(\"./docs\") in case you cd'ed already to the Unfold project.","category":"page"}]
}
